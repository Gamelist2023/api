<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>サーバー管理システム</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <style>
        /* 全体的なスタイル */
        body {
            font-family: 'Consolas', monospace;
            background-color: #eee;
            margin: 0;
            padding: 0;
            color: #222;
            overflow: hidden;
        }

        /* デスクトップ */
        #desktop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding-bottom: 40px;
            background: #007bff;
            background: -webkit-linear-gradient(to bottom, #007bff, #663399);
            background: linear-gradient(to bottom, #007bff, #663399);
            overflow: hidden;
        }

        /* タスクバー */
        #taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #ccc;
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 2;
            display: none;
            bottom: 0;
        }

        #taskbar .icon {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 20px;
        }

        /* ウィンドウのスタイル */
        .window {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: absolute;
            min-width: 300px;
            min-height: 200px;
            resize: both;
            overflow-y: hidden;
            z-index: 1;
        }

        /* ウィンドウタイトルバー */
        .window-titlebar {
            background-color: #2196F3;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .window-titlebar h2 {
            margin: 0;
            font-size: 14px;
        }

        .window-titlebar .controls button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-left: 8px;
        }

        /* ウィンドウコンテンツ */
        .window-content {
            padding: 10px;
            height: calc(100% - 36px);
            overflow-y: auto;
        }

        /* タブ */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 8px 12px;
            transition: background-color 0.3s;
            font-size: 13px;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 10px;
            border: 1px solid #ccc;
            border-top: none;
        }

        .tablinks {
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .tablinks::-webkit-scrollbar {
            display: none;
        }

        /* コンソール出力 */
        #console-output {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 8px;
            background-color: #000;
            color: #fff;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
        }

        /* テーブル */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            text-align: left;
            padding: 6px;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        /* フォーム */
        label {
            display: block;
            margin-bottom: 5px;
        }

        input[type="text"],
        input[type="password"],
        textarea {
            width: calc(100% - 12px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        /* ボタン */
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        .button:hover {
            background-color: #45a049;
        }

        .close-button {
            background-color: #f44336;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        .close-button:hover {
            background-color: #d32f2f;
        }

        /* リスト */
        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        li {
            margin-bottom: 5px;
        }

        /* エラーメッセージ */
        .error {
            color: red;
            margin-bottom: 10px;
        }

        /* ログインフォーム */
        #login-form {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* 背景を暗くする */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 5;
        }

        /* iframeのスタイル */
        iframe {
            width: 100%;
            height: calc(100% - 36px);
            border: none;
        }


        /* 電卓アプリのスタイル */
        #calculator-window {
            width: 240px;
            /* 横幅を縮小 */
            height: 300px;
            /* 高さを縮小 */
        }

        #calculator input[type="button"] {
            width: 40px;
            /* ボタンの横幅を縮小 */
            height: 40px;
            /* ボタンの高さを縮小 */
            margin: 4px;
            /* マージンを縮小 */
            font-size: 16px;
            /* フォントサイズを縮小 */
        }

        #calculator #display {
            width: calc(100% - 18px);
            /* 表示領域の幅を調整 */
            height: 30px;
            /* 表示領域の高さを縮小 */
            margin: 4px;
            /* マージンを縮小 */
            font-size: 18px;
            /* フォントサイズを縮小 */
        }

        /* 時計アプリのスタイル */
        #clock-window {
            width: 300px;
            height: 100px;
        }

        #clock {
            width: 100%;
            height: 100%;
            font-size: 36px;
            text-align: center;
            line-height: 80px;
            /* 時計の文字を中央に配置 */
        }

        @media (max-width: 768px) {
            .window {
                min-width: 90%;
                /* 画面幅の90%に */
                min-height: 60%;
                /* 画面高さの60%に */
                top: 10%;
                /* 上からの位置を調整 */
                left: 5%;
                /* 左からの位置を調整 */
            }

            #taskbar {
                height: 60px;
                /* タスクバーの高さを大きく */
            }

            #taskbar .icon {
                width: 40px;
                /* アイコンサイズを大きく */
                height: 40px;
                font-size: 24px;
            }


        }
    </style>
</head>

<body>
    <div id="taskbar">
        <div class="icon" onclick="openWindow('server-management')">⚙️</div>
        <div class="icon" onclick="openWindow('web-browser-window')">🌐</div>
        <div class="icon" onclick="openWindow('notepad-window')">📝</div>
        <div class="icon" onclick="openWindow('resource-monitor-window')">📊</div>
        <div class="icon" onclick="openWindow('calculator-window')">🧮</div>
        <div class="icon" onclick="openWindow('clock-window')">⏱️</div>
    </div>

    <div id="desktop">
        <div id="overlay"></div>

        <div id="login-form">
            <h2>サーバー管理システム</h2>
            <form id="login-form-form">
                <label for="password">パスワード:</label>
                <input type="password" id="password" name="password" required autocomplete="new-password">
                <button class="button" type="submit">ログイン</button>
                <div id="error-message" class="error"></div>
            </form>
        </div>

        <div id="server-management" class="window"
            style="display: none; width: 800px; height: 600px; top: 100px; left: 100px;">
            <div class="window-titlebar">
                <h2>サーバー管理</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('server-management')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div class="tab">
                    <button class="tablinks" onclick="openTab(event, 'server-status')">ステータス</button>
                    <button class="tablinks" onclick="openTab(event, 'processes')">プロセス</button>
                    <button class="tablinks" onclick="openTab(event, 'console')">コンソール</button>
                    <button class="tablinks" onclick="openTab(event, 'ban-management')">BAN管理</button>
                    <button class="tablinks" onclick="openTab(event, 'file-management')">ファイル管理</button>
                </div>

                <div id="server-status" class="tabcontent">
                    <h3>サーバー情報</h3>
                    <div id="server-status-content"></div>
                    <form id="stop-server-form">
                        <button class="button" type="submit">サーバー停止</button>
                    </form>
                    <br>
                    <form id="start-server-form">
                        <button class="button" type="submit">サーバー起動</button>
                    </form>
                </div>

                <div id="processes" class="tabcontent">
                    <h3>実行中のプロセス</h3>
                    <pre id="processes-list"></pre>
                </div>

                <div id="console" class="tabcontent">
                    <h3>コンソール出力</h3>
                    <pre id="console-output"></pre>
                </div>

                <div id="ban-management" class="tabcontent">
                    <h3>BAN管理</h3>
                    <p>現在のBAN人数: <span id="banned-count">0</span></p>
                    <table id="ban-history">
                        <thead>
                            <tr>
                                <th>ユーザーID</th>
                                <th>BAN時間</th>
                                <th>解除</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <form id="unban-form">
                        <label for="user-id">ユーザーID:</label>
                        <input type="text" id="user-id" name="user-id" required>
                        <button class="button" type="submit">BAN解除</button>
                    </form>
                </div>

                <div id="file-management" class="tabcontent">
                    <h3>ファイル管理</h3>
                    <div class="management-section">
                        <form id="rename-form">
                            <label for="old-name">旧ファイル名:</label>
                            <input type="text" id="old-name" name="old-name" required>
                            <label for="new-name">新ファイル名:</label>
                            <input type="text" id="new-name" name="new-name" required>
                            <button class="button" type="submit">名前変更</button>
                        </form>
                        <div id="rename-result"></div>
                    </div>
                    <div class="management-section">
                        <form id="show-form">
                            <label for="show-file">ファイル名(拡張子含む):</label>
                            <input type="text" id="show-file" name="file_name" required>
                            <button class="button" type="submit">表示</button>
                        </form>
                        <pre id="show-result"
                            style="height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-top: 10px;"></pre>
                    </div>
                    <div class="management-section">
                        <form id="update-json-form">
                            <label for="json-file-path">ファイル名(拡張子含む):</label>
                            <input type="text" id="json-file-path" name="file_path" required>
                            <label for="json-data">データ:</label>
                            <textarea id="json-data" name="data" rows="5" required></textarea>
                            <button class="button" type="submit">データ更新</button>
                        </form>
                        <br>
                        <div id="update-json-result"></div>
                    </div>
                    <div class="management-section">
                        <form id="execute-command-form">
                            <label for="command-to-execute">コマンド:</label>
                            <input type="text" id="command-to-execute" name="command_to_execute" required>
                            <button class="button" type="submit">実行</button>
                        </form>
                        <div id="command-result"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="web-browser-window" class="window"
            style="display: none; width: 800px; height: 600px; top: 150px; left: 150px;">
            <div class="window-titlebar">
                <h2>Webブラウザ</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('web-browser-window')">X</button>
                </div>
            </div>
            <div class="window-content">
                <iframe id="web-browser-iframe" src="https://gamelist1990.github.io/gamelist1990/page/"></iframe>
            </div>
        </div>



        <div id="resource-monitor-window" class="window"
            style="display: none; width: 400px; height: 300px; top: 250px; left: 250px;">
            <div class="window-titlebar">
                <h2>システムリソースモニター</h2>
                <div class="controls">
                    <button class="close-button" onclick="closeWindow('resource-monitor-window')">X</button>
                </div>
            </div>
            <div class="window-content">
                <div id="cpu-usage" style="width: 100%; height: 100px; margin-bottom: 20px;"></div>
                <div id="memory-usage" style="width: 100%; height: 100px;"></div>
            </div>
        </div>
    </div>

    <div id="calculator-window" class="window"
        style="display: none; width: 300px; height: 400px; top: 100px; left: 100px;">
        <div class="window-titlebar">
            <h2>電卓</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('calculator-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <div id="calculator">
                <input type="text" id="display" readonly>
                <input type="button" value="7" onclick="inputDigit('7')">
                <input type="button" value="8" onclick="inputDigit('8')">
                <input type="button" value="9" onclick="inputDigit('9')">
                <input type="button" value="/" onclick="inputOperator('/')">
                <br>
                <input type="button" value="4" onclick="inputDigit('4')">
                <input type="button" value="5" onclick="inputDigit('5')">
                <input type="button" value="6" onclick="inputDigit('6')">
                <input type="button" value="*" onclick="inputOperator('*')">
                <br>
                <input type="button" value="1" onclick="inputDigit('1')">
                <input type="button" value="2" onclick="inputDigit('2')">
                <input type="button" value="3" onclick="inputDigit('3')">
                <input type="button" value="-" onclick="inputOperator('-')">
                <br>
                <input type="button" value="0" onclick="inputDigit('0')">
                <input type="button" value="." onclick="inputDecimal('.')">
                <input type="button" value="C" onclick="clearDisplay()">
                <input type="button" value="+" onclick="inputOperator('+')">
                <br>
                <input type="button" value="=" onclick="calculate()" style="width: 210px;">
            </div>
        </div>
    </div>

    <div id="clock-window" class="window" style="display: none; width: 300px; height: 100px; top: 200px; left: 200px;">
        <div class="window-titlebar">
            <h2>時計</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('clock-window')">X</button>
            </div>
        </div>
        <div class="window-content">
            <div id="clock"></div>
        </div>
    </div>
    <div id="notepad-window" class="window"
        style="display: none; width: 600px; height: 400px; top: 200px; left: 200px;">
        <div class="window-titlebar">
            <h2>メモ帳</h2>
            <div class="controls">
                <button class="close-button" onclick="closeWindow('notepad-window')">X</button>
            </div>
        </div>
        <div class="window-content" style="padding-bottom: 40px;"> <textarea id="notepad-textarea"
                style="width: 100%; height: calc(100% - 35px);"></textarea>
            <br>
            <button class="button" onclick="saveNotepad()"
                style="position: absolute; bottom: 10px; left: 10px;">保存</button>
        </div>
    </div>
    </div>
    </div>












    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ログインフォームの送信イベント
            document.getElementById('login-form-form').addEventListener('submit', async (event) => {
                event.preventDefault();
                await login();
            });

            dragElement(document.getElementById("server-management"));
            dragElement(document.getElementById("web-browser-window"));
            dragElement(document.getElementById("notepad-window"));
            dragElement(document.getElementById("resource-monitor-window")); // リソースモニターウィンドウを追加
            dragElement(document.getElementById("calculator-window"));
            dragElement(document.getElementById("clock-window"));

            // 最初にステータスタブを開く
            document.querySelector('#server-management .tab button:first-child').click();
        });

        let ws; // WebSocket オブジェクトをグローバルスコープに

        // ログイン処理
        async function login() {
            const password = document.getElementById('password').value;

            try {
                const response = await fetch('/antibot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `password=${password}`
                });

                if (response.ok) {
                    // ログイン成功
                    document.getElementById('login-form').style.display = 'none';
                    document.getElementById('overlay').style.display = 'none';
                    document.getElementById('server-management').style.display = 'block';
                    document.getElementById('taskbar').style.display = 'flex';

                    const pusher = new Pusher('b7ac1ff8c001c16fab67', {
                        cluster: 'ap3',
                        authEndpoint: '/pusher/auth'
                    });

                    const channel = pusher.subscribe('private-my-channel');


                    channel.bind('pusher:subscription_succeeded', () => {
                        console.log('Pusher: Subscribed to private-my-channel');

                        // チャンネル登録成功後にデータ取得のリクエストを送信
                        getServerStatus();
                        getResources(); // リソース情報を取得

                    });

                    channel.bind('server_status', (data) => {
                        console.log('Received server status:', data); // デバッグログを追加
                        updateServerStatus(data.data);
                    });

                    channel.bind('resources', (data) => {
                        console.log('Received resources:', data); // デバッグログを追加
                        updateResourceMonitor(data);
                    });

                    channel.bind('console_log', (data) => { // イベント名を修正
                        console.log('Received console log:', data); // デバッグログを追加
                        updateConsoleLog(data);
                    });
                   

                } else {
                    document.getElementById('error-message').textContent = 'パスワードが間違っています。';
                }
            } catch (error) {
                console.error(error);
                document.getElementById('error-message').textContent = 'エラーが発生しました。';
            }
        }

        // ウィンドウをドラッグで移動可能にする関数
        function dragElement(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            let isDragging = false; // ドラッグ中かどうかを示すフラグ

            // タッチイベントとマウスイベントの両方に対応
            elmnt.querySelector('.window-titlebar').addEventListener('mousedown', dragMouseDown);
            elmnt.querySelector('.window-titlebar').addEventListener('touchstart', dragMouseDown);

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();

                // タッチイベントの場合、最初のタッチポイントの座標を取得
                if (e.type === 'touchstart') {
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                } else {
                    // マウスイベントの場合、通常の座標を取得
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                }

                isDragging = true; // ドラッグ開始

                // タッチイベントとマウスイベントの両方に対応
                document.addEventListener('mouseup', closeDragElement);
                document.addEventListener('touchend', closeDragElement);
                document.addEventListener('mousemove', elementDrag);
                document.addEventListener('touchmove', elementDrag);
            }

            function elementDrag(e) {
                if (!isDragging) return; // ドラッグ中でない場合は処理しない

                e = e || window.event;
                e.preventDefault();

                // タッチイベントの場合、最初のタッチポイントの座標を取得
                if (e.type === 'touchmove') {
                    pos1 = pos3 - e.touches[0].clientX;
                    pos2 = pos4 - e.touches[0].clientY;
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                } else {
                    // マウスイベントの場合、通常の座標を取得
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                }

                // 要素の位置を更新
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                isDragging = false; // ドラッグ終了

                // イベントリスナーを削除
                document.removeEventListener('mouseup', closeDragElement);
                document.removeEventListener('touchend', closeDragElement);
                document.removeEventListener('mousemove', elementDrag);
                document.removeEventListener('touchmove', elementDrag);
            }
        }


        // ウィンドウを開く関数
        // ウィンドウを開く関数
        function openWindow(windowId) {
            const appWindow = document.getElementById(windowId); // アプリケーションウィンドウの要素
            appWindow.style.display = 'block';

            // ウィンドウの初期サイズを画面サイズに合わせて調整
            const screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
            const screenHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

            // ウィンドウの幅を画面幅の80%、高さを画面高さの60%に設定 (必要に応じて調整)
            appWindow.style.width = Math.floor(screenWidth * 0.8) + 'px';
            appWindow.style.height = Math.floor(screenHeight * 0.6) + 'px';

            // ウィンドウの位置を画面中央に設定
            appWindow.style.top = Math.floor((screenHeight - appWindow.offsetHeight) / 2) + 'px';
            appWindow.style.left = Math.floor((screenWidth - appWindow.offsetWidth) / 2) + 'px';
        }

        // ウィンドウを閉じる関数
        function closeWindow(windowId) {
            document.getElementById(windowId).style.display = 'none';
            // ログインフォームとオーバーレイを表示
            // document.getElementById('login-form').style.display = 'block';
            // document.getElementById('overlay').style.display = 'block';
        }

        // タブ切り替え関数
        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // サーバー情報の取得
        function getServerStatus() {
            ws.send(JSON.stringify({ command: "get_server_status" }));
        }

        // プロセス一覧の取得
        function getProcesses() {
            ws.send(JSON.stringify({ command: "get_processes" }));
        }

        // コンソールログの取得
        function getConsoleLog() {
            ws.send(JSON.stringify({ command: "get_console_log" }));
        }

        // サーバー情報の更新
        function updateServerStatus(data) {
            let statusHTML = '';
            for (const [key, value] of Object.entries(data)) {
                if (key === "ネットワーク情報") {
                    let displayValue = JSON.stringify(value, null, 2); // 整形して表示
                    statusHTML += `<p><strong>${key}:</strong></p><pre>${displayValue}</pre>`;
                } else {
                    statusHTML += `<p><strong>${key}:</strong> ${value}</p>`;
                }
            }
            document.getElementById('server-status-content').innerHTML = statusHTML;
        }

        // プロセス一覧の更新
        function updateProcesses(data) {
            document.getElementById('processes-list').textContent = data.processes;
        }

        // コンソールログの更新
        function updateConsoleLog(data) {
                console.log("Updating console log with:", data); // デバッグログを追加
                if (data.console_log && Array.isArray(data.console_log)) {
                    document.getElementById('console-output').textContent = data.console_log.join('\n'); // 配列を改行で結合
                } else {
                    console.error("Invalid console log data:", data); // 無効なデータの場合のエラー処理
                }
            }

        // BAN履歴の更新
        async function updateBanHistory() {
            try {
                const response = await fetch('/antibot/history');
                const data = await response.json();

                document.getElementById('banned-count').textContent = data.bannedCount;
                const banHistoryTable = document.getElementById('ban-history').querySelector('tbody');
                banHistoryTable.innerHTML = ''; // テーブルをクリア

                data.banHistory.forEach(ban => {
                    const row = banHistoryTable.insertRow();
                    row.insertCell().textContent = ban.user_id;
                    row.insertCell().textContent = ban.ban_time;

                    const unbanButton = document.createElement('button');
                    unbanButton.textContent = '解除';
                    unbanButton.classList.add('button');
                    unbanButton.addEventListener('click', () => {
                        unbanUser(ban.user_id);
                    });
                    row.insertCell().appendChild(unbanButton);
                });
            } catch (error) {
                console.error(error);
            }
        }

        // ユーザーのBAN解除
        async function unbanUser(userId) {
            try {
                const response = await fetch('/antibot/unban', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: userId })
                });

                if (response.ok) {
                    updateBanHistory();
                } else {
                    console.error('ユーザーのBAN解除に失敗しました。');
                }
            } catch (error) {
                console.error(error);
            }
        }

        function getServerStatus() {
            fetch('/admin/status', { // POSTリクエストに変更
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: document.getElementById('password').value })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.data) { // data.data をチェック
                        updateServerStatus(data.data);
                    } else {
                        console.error("サーバー情報の取得に失敗しました:", data); // エラーメッセージを表示
                    }
                })
                .catch(error => {
                    console.error("サーバー情報の取得中にエラーが発生しました:", error);
                });
        }

        // サーバーの再起動
        async function restartServer() {
            try {
                const response = await fetch('/admin/restart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: document.getElementById('password').value })
                });

                if (response.ok) {
                    console.log('サーバーの再起動リクエストを送信しました。');
                } else {
                    console.error('サーバーの再起動に失敗しました。');
                }
            } catch (error) {
                console.error(error);
            }
        }

        // サーバーのシャットダウン
        async function shutdownServer() {
            if (!confirm('本当にサーバーをシャットダウンしますか？')) return;
            try {
                const response = await fetch('/admin/shutdown', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: document.getElementById('password').value })
                });

                if (response.ok) {
                    console.log('サーバーのシャットダウンリクエストを送信しました。');
                } else {
                    console.error('サーバーのシャットダウンに失敗しました。');
                }
            } catch (error) {
                console.error(error);
            }
        }

        // ファイル/フォルダの名前変更
        document.getElementById('rename-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const oldName = document.getElementById('old-name').value;
            const newName = document.getElementById('new-name').value;

            try {
                const response = await fetch('/admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ rename: { old_name: oldName, new_name: newName }, password: document.getElementById('password').value })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('rename-result').textContent = data.message;
                } else {
                    document.getElementById('rename-result').textContent = 'エラーが発生しました。';
                }
            } catch (error) {
                console.error(error);
                document.getElementById('rename-result').textContent = 'エラーが発生しました。';
            }
        });

        // ファイルの表示
        document.getElementById('show-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const showFilename = document.getElementById('show-file').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch('/admin/showfile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ file_name: showFilename, password: password })
                });

                if (response.ok) {
                    const fileContent = await response.text();
                    const formattedContent = fileContent.replace(/\n/g, '<br>'); // 改行コードを <br> タグに変換
                    document.getElementById('show-result').innerHTML = formattedContent; // innerHTML を使用して HTML として設定
                } else {
                    const errorData = await response.json();
                    document.getElementById('show-result').textContent = errorData.error;
                }

            } catch (error) {
                console.error(error);
                document.getElementById('show-result').textContent = 'エラーが発生しました。';
            }
        });

        // BAN解除フォームの送信イベント
        document.getElementById('unban-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const userId = document.getElementById('user-id').value;
            await unbanUser(userId);
        });

        // JSON更新フォームの送信イベント
        document.getElementById('update-json-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const filePath = document.getElementById('json-file-path').value;
            const jsonData = document.getElementById('json-data').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch('/admin/update_json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        password: password,
                        file_path: filePath, // file_path を追加
                        data: JSON.parse(jsonData) // data を追加
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('update-json-result').textContent = data.message;
                } else {
                    document.getElementById('update-json-result').textContent = 'エラーが発生しました。';
                }
            } catch (error) {
                console.error(error);
                document.getElementById('update-json-result').textContent = 'エラーが発生しました。';
            }
        });

        function openWebBrowser(url) {
            const webBrowserWindow = document.getElementById('web-browser-window');
            const webBrowserIframe = document.getElementById('web-browser-iframe');
            webBrowserIframe.src = url; // iframe の src 属性を設定
            webBrowserWindow.style.display = 'block';
        }

        // サーバー停止
        document.getElementById('stop-server-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            try {
                const response = await fetch('/admin/update_server_status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `status=stop&password=${document.getElementById('password').value}`
                });
                if (response.ok) {
                    alert("サーバーを停止しました。");
                    getServerStatus(); // WebSocket でステータス情報を更新
                } else {
                    alert("サーバーの停止に失敗しました。");
                }
            } catch (error) {
                console.error(error);
                alert("サーバーの停止中にエラーが発生しました。");
            }
        });

        // サーバー起動
        document.getElementById('start-server-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            try {
                const response = await fetch('/admin/update_server_status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `status=start&password=${document.getElementById('password').value}`
                });
                if (response.ok) {
                    alert("サーバーを起動しました。");
                    getServerStatus(); // WebSocket でステータス情報を更新
                } else {
                    alert("サーバーの起動に失敗しました。");
                }
            } catch (error) {
                console.error(error);
                alert("サーバーの起動中にエラーが発生しました。");
            }
        });

        function getResources() {
            
        }

        // リソース情報の更新
        function updateResourceMonitor(data) {
            // ここにチャート描画ライブラリを用いた処理を追加
            // 例：CPU使用率を円グラフで表示
            drawChart('cpu-usage', 'CPU使用率', [data.cpu_usage, 100 - data.cpu_usage]);
            // 例：メモリ使用率をプログレスバーで表示
            drawChart('memory-usage', 'メモリ使用率', [data.memory_usage, 100 - data.memory_usage]);
        }
        setInterval(getResources, 2000);

        // チャート描画関数（ダミー、実際のライブラリに置き換えてください）
        function drawChart(elementId, title, data) {
            document.getElementById(elementId).innerHTML = `
        <h3>${title}</h3>
        <p>使用率: ${data[0]}%</p>
    `;
        }

        // 電卓のJavaScript関数
        let currentInput = '';
        let previousInput = '';
        let currentOperator = '';

        function appendToDisplay(value) {
            currentInput += value;
            document.getElementById('display').value = currentInput;
        }

        function inputDigit(digit) {
            if (currentInput === '0') {
                currentInput = digit;
            } else {
                currentInput += digit;
            }
            updateDisplay();
        }

        function inputOperator(operator) {
            if (currentOperator !== '') {
                calculate();
            }
            previousInput = currentInput;
            currentOperator = operator;
            currentInput = '';
        }

        function inputDecimal() {
            if (!currentInput.includes('.')) {
                currentInput += '.';
            }
            updateDisplay();
        }

        function clearDisplay() {
            currentInput = '';
            previousInput = '';
            currentOperator = '';
            updateDisplay();
        }

        function calculate() {
            let result;
            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);
            if (isNaN(prev) || isNaN(current)) return;
            switch (currentOperator) {
                case '+':
                    result = prev + current;
                    break;
                case '-':
                    result = prev - current;
                    break;
                case '*':
                    result = prev * current;
                    break;
                case '/':
                    if (current === 0) {
                        alert('0で割ることはできません。');
                        return;
                    }
                    result = prev / current;
                    break;
                default:
                    return;
            }
            currentInput = result.toString();
            previousInput = '';
            currentOperator = '';
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('display').value = currentInput;
        }

        // 時計のJavaScript関数
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateClock, 1000);


        // メモ帳の保存機能
        function saveNotepad() {
            const notepadContent = document.getElementById('notepad-textarea').value;
            localStorage.setItem('notepadContent', notepadContent);
            alert('メモ帳が保存されました。');
        }

        // メモ帳の読み込み (ページ読み込み時に実行)
        window.addEventListener('load', () => {
            const savedContent = localStorage.getItem('notepadContent');
            if (savedContent) {
                document.getElementById('notepad-textarea').value = savedContent;
            }
        });



    </script>

</body>

</html>